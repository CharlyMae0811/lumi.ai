<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>lumi</title>
<style>
  :root { --fg:#cfe7ff; --accent:#79b7ff; --glow:#7cd3ff; }
  html,body {
    margin:0; height:100%; background:#0a0f14; color:#dfe8f2;
    font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  }
  .wrap { max-width:980px; margin:0 auto; padding:28px 20px 48px; }
  header { text-align:center; margin-bottom:18px; }
  h1 { margin:0; font-weight:700; letter-spacing:.02em; font-size:40px; color:#eaf4ff; }
  .sub { opacity:.75; margin-top:4px; }
  .row { display:flex; justify-content:space-between; align-items:center; margin:18px 0 8px; }
  .chip {
    border:1px solid rgba(124,211,255,.28); padding:8px 14px; border-radius:12px;
    color:#cde9ff; background:linear-gradient(180deg, rgba(124,211,255,.09), rgba(124,211,255,.03));
    box-shadow:0 0 18px rgba(124,211,255,.08) inset;
  }
  .difficulty label { margin:0 6px; cursor:pointer; }
  .stage { position:relative; height:420px; display:grid; place-items:center; }
  canvas { width:min(520px, 90vw); height:min(520px, 90vw);
           filter:drop-shadow(0 20px 60px rgba(124,211,255,.25)); }
  .controls { display:flex; gap:18px; justify-content:center; margin-top:18px; flex-wrap:wrap; }
  button, .micBtn {
    background:rgba(22,45,70,.6); border:1px solid rgba(124,211,255,.4);
    border-radius:14px; padding:14px 18px; font-size:16px; color:#dff1ff; cursor:pointer;
    box-shadow:0 0 24px rgba(124,211,255,.15), inset 0 0 20px rgba(124,211,255,.05);
    transition:transform .1s ease, box-shadow .2s ease, border-color .2s ease;
  }
  button:hover, .micBtn:hover {
    transform:translateY(-1px);
    box-shadow:0 0 34px rgba(124,211,255,.28), inset 0 0 24px rgba(124,211,255,.08);
  }
  .micBtn { width:64px; height:64px; border-radius:50%; display:grid; place-items:center; }
  .reply {
    margin:18px auto 0; max-width:760px; padding:14px 16px;
    border:1px solid rgba(124,211,255,.25); border-radius:12px;
    background:rgba(15,25,35,.6); white-space:pre-wrap; min-height:44px;
  }
  .inputRow { display:flex; gap:10px; justify-content:center; margin:14px 0 0; }
  .inputRow input {
    width:min(560px, 90vw); padding:12px 14px; border-radius:12px;
    border:1px solid rgba(124,211,255,.25);
    background:rgba(12,22,32,.6); color:#eaf4ff; outline:none;
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>lumi</h1>
      <div class="sub">Train. Learn. Master.</div>
    </header>

    <div class="row">
      <div class="chip">FBA</div>
      <div class="difficulty chip">
        Difficulty:
        <label><input type="radio" name="diff" value="easy"> Easy</label>
        <label><input type="radio" name="diff" value="medium" checked> Medium</label>
        <label><input type="radio" name="diff" value="hard"> Hard</label>
      </div>
    </div>

    <div class="stage"><canvas id="fog"></canvas></div>

    <div class="controls">
      <button id="hintBtn">Give me hints</button>
      <div class="micBtn" id="micBtn" title="Hold to talk">ðŸŽ¤</div>
      <button id="answerBtn">Answer for me</button>
    </div>

    <div class="inputRow">
      <input id="textInput" placeholder="Say or type your promptâ€¦" />
    </div>

    <div class="reply" id="reply"></div>
  </div>

<script>
/* ---------- CONFIG ---------- */
const N8N_WEBHOOK_URL = "https://charly175820478052.app.n8n.cloud/webhook-test/seller-call-simulation"; // replace with your webhook

<script>
/* ---------- FOG SPHERE (simple + robust) ---------- */
const canvas = document.getElementById('fog');
const ctx = canvas.getContext('2d', { willReadFrequently: true });

function resize() {
  const s = Math.min(520, Math.floor(window.innerWidth * 0.9));
  const dpr = Math.max(1, window.devicePixelRatio || 1);
  canvas.width = canvas.height = Math.floor(s * dpr);
  canvas.style.width = canvas.style.height = s + 'px';
  ctx.setTransform(1,0,0,1,0,0);              // reset any transforms
  ctx.scale(dpr, dpr);                         // draw in CSS pixels
}
window.addEventListener('resize', resize); resize();

/* Mic analyser (optional) */
let audioCtx, analyser, micStream, amp = 0;
async function initMic() {
  if (analyser) return;
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  micStream = await navigator.mediaDevices.getUserMedia({ audio: true });
  const src = audioCtx.createMediaStreamSource(micStream);
  analyser = audioCtx.createAnalyser();
  analyser.fftSize = 512;
  analyser.smoothingTimeConstant = 0.8;
  analyser.minDecibels = -90;
  analyser.maxDecibels = -10;
  src.connect(analyser);
}
function readAmplitude() {
  if (!analyser) return 0;
  const buf = new Uint8Array(analyser.fftSize);
  analyser.getByteTimeDomainData(buf);
  let sum = 0;
  for (let i=0;i<buf.length;i++) {
    const v = (buf[i]-128)/128; sum += v*v;
  }
  return Math.min(1, Math.sqrt(sum/buf.length)*3); // 0..1
}

/* Prebuilt â€œblobsâ€ that swirl to form a cloud */
const blobs = Array.from({length: 28}, (_,i) => ({
  a: Math.random()*Math.PI*2,               // angle
  r: 0.25 + Math.random()*0.55,             // distance (0..1 of radius)
  s: 0.10 + Math.random()*0.35,             // size (as % of radius)
  w: 0.15 + Math.random()*0.35,             // wobble
  sp: (Math.random()*0.6 + 0.2) * (Math.random()<0.5?-1:1) // angular speed
}));

/* Colors */
const baseBlue = [90, 160, 255];
const lav      = [160, 130, 255];

function mix(a,b,t){ return a+(b-a)*t; }

let t0 = performance.now();
function draw() {
  requestAnimationFrame(draw);
  const t = (performance.now()-t0)/1000;

  // target pulse: mic if present, otherwise a gentle breathing curve
  const mic = readAmplitude();
  const target = mic || (0.25 + 0.20*Math.sin(t*1.2));
  amp = amp*0.85 + target*0.15;

  // canvas & sphere metrics in CSS pixels
  const cssW = parseFloat(canvas.style.width) || 520;
  const cssH = parseFloat(canvas.style.height) || 520;
  const cx = cssW/2, cy = cssH/2;
  const R  = Math.min(cssW, cssH)*0.42*(1 + 0.06*amp);  // pulse radius

  // clear
  ctx.clearRect(0,0,cssW,cssH);

  // clip to a circle (the â€œsphereâ€)
  ctx.save();
  ctx.beginPath();
  ctx.arc(cx, cy, R, 0, Math.PI*2);
  ctx.clip();

  // base radial glow
  const g = ctx.createRadialGradient(cx, cy, R*0.15, cx, cy, R);
  g.addColorStop(0, 'rgba(120, 190, 255, 0.35)');
  g.addColorStop(1, 'rgba(120, 190, 255, 0.00)');
  ctx.fillStyle = g;
  ctx.fillRect(cx-R, cy-R, R*2, R*2);

  // foggy blobs (soft circles) that swirl
  ctx.globalCompositeOperation = 'lighter';
  for (const b of blobs) {
    const ang = b.a + b.sp*t + Math.sin(t*0.7 + b.a)*0.2*b.w;
    const rr  = b.r * (1 + 0.05*Math.sin(t*0.9 + b.a));
    const x   = cx + Math.cos(ang) * rr * (R*0.95);
    const y   = cy + Math.sin(ang) * rr * (R*0.95);
    const rad = R * b.s * (1 + amp*0.4);

    const cMix = Math.min(1, Math.max(0, (rr+0.2))); // inner blue -> outer lavender
    const r = Math.floor(mix(baseBlue[0], lav[0], cMix));
    const g = Math.floor(mix(baseBlue[1], lav[1], cMix));
    const bC= Math.floor(mix(baseBlue[2], lav[2], cMix));

    const grad = ctx.createRadialGradient(x,y, rad*0.2, x,y, rad);
    grad.addColorStop(0, `rgba(${r},${g},${bC},${0.22 + 0.25*amp})`);
    grad.addColorStop(1, `rgba(${r},${g},${bC},0)`);
    ctx.fillStyle = grad;
    ctx.beginPath();
    ctx.arc(x,y,rad,0,Math.PI*2);
    ctx.fill();
  }
  ctx.globalCompositeOperation = 'source-over';
  ctx.restore();

  // soft rim + outer glow
  ctx.beginPath();
  ctx.arc(cx, cy, R, 0, Math.PI*2);
  ctx.shadowBlur = 40 + amp*80;
  ctx.shadowColor = 'rgba(124,211,255,0.35)';
  ctx.strokeStyle = 'rgba(124,211,255,0.12)';
  ctx.lineWidth = 2;
  ctx.stroke();
}
draw();

/* Keep the rest of your UI + networking code below this block */
</script>


/* ---------- UI + N8N ---------- */
const replyEl=document.getElementById('reply');
const textInput=document.getElementById('textInput');
async function sendToN8N({text,mode}){
  const diff=(document.querySelector('input[name="diff"]:checked')||{}).value||'medium';
  const res=await fetch(N8N_WEBHOOK_URL,{
    method:'POST', headers:{'Content-Type':'application/json'},
    body:JSON.stringify({text,mode,difficulty:diff})
  });
  if(!res.ok) throw new Error(`n8n ${res.status}`);
  const data=await res.json(); return data.reply||"(no reply)";
}
function speak(text){
  try{const u=new SpeechSynthesisUtterance(text);u.rate=1;u.pitch=1;u.lang='en-US';
    speechSynthesis.cancel();speechSynthesis.speak(u);}catch{}
}
async function handle(mode){
  const text=textInput.value.trim()||"(no prompt)"; replyEl.textContent="â€¦";
  try{const out=await sendToN8N({text,mode}); replyEl.textContent=out; speak(out);}
  catch(e){replyEl.textContent="Error: "+e.message;}
}
document.getElementById('hintBtn').onclick=()=>handle('hint');
document.getElementById('answerBtn').onclick=()=>handle('answer');

const micBtn=document.getElementById('micBtn');
let rec,recognizing=false;
micBtn.addEventListener('mousedown',async()=>{
  await initMic();
  if('webkitSpeechRecognition'in window){
    const R=new webkitSpeechRecognition();
    R.lang='en-US'; R.interimResults=true; R.continuous=true;
    R.onresult=(e)=>{let s='';for(let i=0;i<e.results.length;i++)s+=e.results[i][0].transcript;
      textInput.value=s;};
    R.onend=()=>recognizing=false; rec=R; recognizing=true; R.start();
  }
});
window.addEventListener('mouseup',()=>{if(rec&&recognizing){rec.stop();recognizing=false;}});
document.body.addEventListener('click',()=>initMic(),{once:true});
</script>
</body>
</html>
